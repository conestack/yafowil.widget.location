!function(t,e){"use strict";class a{constructor(t,e){this.widget=t,this.marker=e,this.create_popup()}create_popup(){let t=document.createElement("a");t.href="#",t.innerHTML="Remove",t.onclick=this.remove_handle.bind(this),this.marker.bindPopup(t)}remove_handle(){let t=this.widget;return t.markers.removeLayer(this.marker),t.lat="",t.lon="",t.zoom="",!1}}class i{constructor(t,e,i){this.widget=t;let o=new L.marker([e,i],{draggable:!0});o.addTo(t.markers),new a(t,o),o.on("dragend",this.dragend_handle.bind(this))}dragend_handle(t){let e=t.target._latlng,a=this.widget;a.lat=e.lat,a.lon=e.lng,a.zoom=a.map.getZoom()}}class o{constructor(t){this.widget=t;let e=this.geosearch=new GeoSearch.GeoSearchControl({provider:new GeoSearch.OpenStreetMapProvider,style:"bar",autoClose:!0});t.map.addControl(e),t.map.on("geosearch/showlocation",this.showloaction_handle.bind(this))}showloaction_handle(t){let e=t.location,a=e.y,o=e.x,n=this.widget;n.markers.clearLayers(),new i(n,a,o),n.lat=a,n.lon=o}}class n{static initialize(t){e("div.location-map",t).each((function(){new n(e(this))}))}constructor(t){this.elem=t,this.id=t.attr("id");let a=t.parent();this._input_lat=e("input.location-lat",a),this._input_lon=e("input.location-lon",a),this._input_zoom=e("input.location-zoom",a),this.change_lat_handle=this.change_lat_handle.bind(this),this._input_lat.on("change",this.change_lat_handle),this.change_lon_handle=this.change_lon_handle.bind(this),this._input_lon.on("change",this.change_lon_handle),this.min_zoom=t.data("min_zoom"),this.max_zoom=t.data("max_zoom"),this._lat=t.data("lat"),this._lon=t.data("lon"),this._zoom=t.data("zoom"),this.value=this.elem.data("value"),this.create_map(),new o(this)}get value(){return this._value}set value(t){this._value=t,t&&(void 0!==t.lat&&void 0!==t.lon&&(this._lat=t.lat,this._lon=t.lon),void 0!==t.zoom&&(this._zoom=t.zoom))}get lat(){return this._lat}set lat(t){this._lat=t,this._input_lat.val(t)}get lon(){return this._lon}set lon(t){this._lon=t,this._input_lon.val(t)}get zoom(){return this._zoom}set zoom(t){this._zoom=t,this._input_zoom.val(t)}create_map(){let t=this.map=new L.map(this.id);this.map.setView([this.lat,this.lon],this.zoom),new L.tileLayer("//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Map data Â© <a href="http://openstreetmap.org">OSM</a>',minZoom:this.min_zoom,maxZoom:this.max_zoom}).addTo(t);let e=this.markers=new L.FeatureGroup;t.addLayer(e),this.value&&new i(this,this.lat,this.lon),t.on("click",this.click_handle.bind(this))}click_handle(t){this.markers.clearLayers();let e=t.latlng;new i(this,e.lat,e.lng),this.lat=e.lat,this.lon=e.lng,this.zoom=this.map.getZoom()}change_val(t,e){let a=parseFloat(t.val());isNaN(a)?t.val(this[e]):(this[e]=a,this.markers.clearLayers(),new i(this,this.lat,this.lon),this.map.setView([this.lat,this.lon],this.zoom))}change_lat_handle(t){t.preventDefault(),this.change_val(e(t.currentTarget),"_lat")}change_lon_handle(t){t.preventDefault(),this.change_val(e(t.currentTarget),"_lon")}}e((function(){void 0!==window.ts?ts.ajax.register(n.initialize,!0):void 0!==window.bdajax?bdajax.register(n.initialize,!0):n.initialize()})),t.LocationWidget=n,t.LocationWidgetMarker=i,t.LocationWidgetMarkerPopup=a,t.LocationWidgetSearch=o,Object.defineProperty(t,"__esModule",{value:!0}),void 0===window.yafowil&&(window.yafowil={}),window.yafowil.location=t}({},jQuery);
//# sourceMappingURL=widget.min.js.map
