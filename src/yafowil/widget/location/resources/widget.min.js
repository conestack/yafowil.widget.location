var yafowil_location=function(t,a){"use strict";class e{constructor(t,a){this.widget=t,this.marker=a,this.create_popup()}create_popup(){let t=document.createElement("a");t.href="#",t.innerHTML="Remove",t.onclick=this.remove_handle.bind(this),this.marker.bindPopup(t)}remove_handle(){let t=this.widget;return t.markers.removeLayer(this.marker),t.lat="",t.lon="",t.zoom="",!1}}class i{constructor(t,a,i){this.widget=t;let o=new L.Marker([a,i],{draggable:!0});o.addTo(t.markers),new e(t,o),o.on("dragend",this.dragend_handle.bind(this))}dragend_handle(t){let a=t.target._latlng,e=this.widget;e.lat=a.lat,e.lon=a.lng,e.zoom=e.map.getZoom()}}class o{constructor(t){this.widget=t;let a=this.geosearch=new GeoSearch.GeoSearchControl({provider:new GeoSearch.OpenStreetMapProvider,style:"bar",autoClose:!0});t.map.addControl(a),t.map.on("geosearch/showlocation",this.showloaction_handle.bind(this))}showloaction_handle(t){let a=t.location,e=a.y,o=a.x,n=this.widget;n.markers.clearLayers(),new i(n,e,o),n.lat=e,n.lon=o}}class n{static initialize(t){a("div.location-map",t).each((function(){new n(a(this))}))}constructor(t){t.data("yafowil-location",this),this.elem=t,this.id=t.attr("id");let e=t.parent();this._input_lat=a("input.location-lat",e),this._input_lon=a("input.location-lon",e),this._input_zoom=a("input.location-zoom",e),this.change_lat_handle=this.change_lat_handle.bind(this),this._input_lat.on("change",this.change_lat_handle),this.change_lon_handle=this.change_lon_handle.bind(this),this._input_lon.on("change",this.change_lon_handle),this.min_zoom=t.data("min_zoom"),this.max_zoom=t.data("max_zoom"),this.tile_layers=t.data("tile_layers"),this._lat=t.data("lat"),this._lon=t.data("lon"),this._zoom=t.data("zoom"),this.value=this.elem.data("value"),this.create_map(),new o(this)}get value(){return this._value}set value(t){this._value=t,t&&(void 0!==t.lat&&void 0!==t.lon&&(this._lat=t.lat,this._lon=t.lon),void 0!==t.zoom&&(this._zoom=t.zoom))}get lat(){return this._lat}set lat(t){this._lat=t,this._input_lat.val(t)}get lon(){return this._lon}set lon(t){this._lon=t,this._input_lon.val(t)}get zoom(){return this._zoom}set zoom(t){this._zoom=t,this._input_zoom.val(t)}create_map(){let t=this.map=new L.Map(this.id);this.map.setView([this.lat,this.lon],this.zoom);for(let a of this.tile_layers)a.options.minZoom=this.min_zoom,a.options.maxZoom=this.max_zoom,new L.TileLayer(a.urlTemplate,a.options).addTo(t);let a=this.markers=new L.FeatureGroup;t.addLayer(a),this.value&&new i(this,this.lat,this.lon),t.on("click",this.click_handle.bind(this))}click_handle(t){this.markers.clearLayers();let a=t.latlng;new i(this,a.lat,a.lng),this.lat=a.lat,this.lon=a.lng,this.zoom=this.map.getZoom()}change_val(t,a){let e=parseFloat(t.val());isNaN(e)?t.val(this[a]):(this[a]=e,this.markers.clearLayers(),new i(this,this.lat,this.lon),this.map.setView([this.lat,this.lon],this.zoom))}change_lat_handle(t){t.preventDefault(),this.change_val(a(t.currentTarget),"_lat")}change_lon_handle(t){t.preventDefault(),this.change_val(a(t.currentTarget),"_lon")}}return a((function(){void 0!==window.ts?ts.ajax.register(n.initialize,!0):void 0!==window.bdajax?bdajax.register(n.initialize,!0):n.initialize()})),t.LocationWidget=n,t.LocationWidgetMarker=i,t.LocationWidgetMarkerPopup=e,t.LocationWidgetSearch=o,Object.defineProperty(t,"__esModule",{value:!0}),window.yafowil=window.yafowil||{},window.yafowil.location=t,t}({},jQuery);
